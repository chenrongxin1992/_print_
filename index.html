<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>座位牌打印</title>
  <link rel="shortcut icon" href="./favicon.ico">
  <link rel="stylesheet" href="./css/layui.css">
  <link rel="stylesheet" href="./css/modules/layui-icon-extend/iconfont.css">

  <style type="text/css">
	.h1title{
		font-size: 35px;
		line-height: 60px;
		text-align: center;
		color: #950040;
		margin:10px auto;
	}
	#printcontent{
	}
	.printcontentdemo{
    	font-family: STXinwei;
    	text-align: center;
    	background-color: #79C48C;
    	font-size: 140px;
    	background: url('./img/test.png');
    	background-size:160mm 79.25mm;
	}
	.printcontentdemo1{
    	font-family: STXinwei;
    	text-align: center;
    	background-color: #79C48C;
    	font-size: 140px;
	}
	.layui-elem-quote{
		border-left: 5px solid #950040;
	}
	
	.layui-btn{
		background-color:#950040;
	}
	.pname{
		padding-top: 40mm;
	}
	.pnameyulan{
		padding-top: 30mm;
	}
	@media print {
	  @page {
	    margin: -15mm; 
	  }
	}
  </style>
</head>
<body>
 
	<div class="layui-container">  
	  <h1 class="h1title">深圳大学校长办公室座位牌打印系统</h1>

	  <blockquote class="layui-elem-quote layui-text">
		  卡片信息
	  </blockquote>

	  <form class="layui-form layui-form-pane" action="">
	  	<div class="layui-form-item layui-form-text">
		    <label class="layui-form-label">卡片名字（多个名字用中文逗号'，'分隔）</label>
		    <div class="layui-input-block">
		      <textarea placeholder="请输入姓名" class="layui-textarea" name="multiname" lay-verify="name"></textarea>
		    </div>
		</div>

		<div class="layui-form-item">
		    <label class="layui-form-label">重复次数</label>
		    <div class="layui-input-inline">
		      <select name="cishu" lay-filter="cishu">
		        <option value="1">1</option>
		        <option value="2" selected="">2</option>
		        <option value="3">3</option>
		        <option value="400">4</option>
		      </select>
		    </div>

			<label class="layui-form-label">规格</label>
		    <div class="layui-input-inline">
		      <select name="type" lay-filter="type">
		        <option value="160*297" selected="">150*297(校办纸)</option>
		        <option value="224*297">210*297(A4纸)</option>
		      </select>
		    </div>
		</div>

		<div class="layui-form-item">
		    <div class="layui-input-block">
		      <button class="layui-btn" lay-submit="" lay-filter="preview"><i class="iconfont layui-extendyulan"></i> 预览</button>
		      <button class="layui-btn" lay-submit="" lay-filter="print"><i class="iconfont layui-extenddayin"></i> 打印</button>
		    </div>
	  	</div>
	  </form>
	  
	  <div id="printcontent">
	  	
	  </div>

	  <hr style="height:1px;border:none;border-top:1px dashed #950040;">
	  <footer style="text-align: center;">
	    <p class="text-center" style="color: #950040;">2019 &copy; SZU</p>
	  </footer>
	</div>

<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script src="./js/jquery.min.js"></script>
<script src="./js/layui.js"></script>
<script src="./js/printThis.js"></script>
<script src="./js/jQuery.print.js"></script>
<script>
layui.use(['layer', 'form'], function(){
  var layer = layui.layer
  ,form = layui.form;
  
  //自定义验证规则
  form.verify({
    name: function(value){
      if(value.length < 2){
        return '请输入要打印的姓名';
      }
    }
  });
  form.on('select(cishu)', function(data){
  	console.log(data)
  	$('#printcontent').empty()
  	$('#printcontent').css('display','')
  })
  form.on('select(type)', function(data){
  	console.log(data)
  	$('#printcontent').empty()
  	$('#printcontent').css('display','')
  })

  form.on('submit(preview)', function(data){
  	if($('.printcontentdemo')){
  		$('#printcontent').empty()
  	}
  	var allname_arr = getallname(data.field.multiname)
    let cishu = data.field.cishu,
    	guige = (data.field.type).split('*')
    let chang = guige[0],
    	kuan = guige[1]
    // console.log(allname_arr)
    // console.log('总共输入',allname_arr.length,'个姓名')
    // console.log('重复次数',data.field.cishu)
    // console.log('规格',data.field.type)

    let finalarr = new Array()
    for(let i=0;i<allname_arr.length;i++){
    	for(let j=0;j<cishu;j++){
    		finalarr.push(allname_arr[i])
    	}
    }
    console.log('finalarr',finalarr)
    let tmpclass = ''
    if(chang == '160'){
    	tmpclass = 'printcontentdemo'
    }
    else{
    	tmpclass = 'printcontentdemo1'
    }
    for(let i=0;i<finalarr.length;i++){
    	let str = "<div class='" + tmpclass + "'><div class='pnameyulan'>"+finalarr[i]+"</div></div>"
	    $("#printcontent").append(str);

    }
    $('.printcontent').trigger('create')
    $('.' + tmpclass ).css('width',chang+'mm')
    $('.' + tmpclass ).css('height',74.25+'mm')
    $('.' + tmpclass ).css('margin','0px auto')
	return false
  });

  form.on('submit(print)', function(data){
  	if($('.printcontentdemo')){
  		$('#printcontent').empty()
  	}
  	var allname_arr = getallname(data.field.multiname)
    let cishu = data.field.cishu,
    	guige = (data.field.type).split('*')
    let chang = guige[0],
    	kuan = guige[1]
    // console.log(allname_arr)
    // console.log('总共输入',allname_arr.length,'个姓名')
    // console.log('重复次数',data.field.cishu)
    // console.log('规格',data.field.type)

    let finalarr = new Array()
    for(let i=0;i<allname_arr.length;i++){
    	for(let j=0;j<cishu;j++){
    		finalarr.push(allname_arr[i])
    	}
    }
    console.log('finalarr',finalarr)
    
    $('#printcontent').css('display','none')
    for(let i=0;i<finalarr.length;i++){
    	let str = "<div class='printcontentdemo'><div class='pname'>"+finalarr[i]+"</div></div>"
	    $("#printcontent").append(str);
    }
    $('.printcontent').trigger('create')
    $('.printcontentdemo').css('width',chang+'mm')
    $('.printcontentdemo').css('height',74.25+'mm')
    $('.printcontentdemo').css('margin','0px auto')
    layer.msg('请稍后', {
	  icon: 16
	  ,shade: 0.9
	  ,time:1000
	  ,shadeClose:true
	});
	Preview()
	setTimeout(function(){
        $('#printcontent').css('display','none')
    },500)
	return false
  })
});

    function Preview() {
		$('#printcontent').css('display','')
        $("#printcontent").printThis({
            debug: false,
            importCSS: true,
            importStyle: true,
            printContainer: true,
            //loadCSS: "/Content/Themes/Default/style.css",
            pageTitle: "",
            removeInline: false,
            printDelay: 333,
            header: null,
            formValues: true
        });
    };

    function getallname(str) {
    	var temp = str.split(/[\\n\s+,，；;]/g);
		var temp1 = temp.join(" ")
		var temp2 = temp1.trim();
		var temp3 = temp2.split(' ')

		for (var i = 0; i < temp.length; i++) {
			console.log(i,temp[i])
			if (temp[i] == "" || temp[i] == null || temp[i].length == 0) {
				temp.splice(i, 1);
				i--;
			}
		}
		return temp
	}
</script> 
</body>
</html>