<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>座位牌打印</title>
  <link rel="shortcut icon" href="./favicon.ico">
  <link rel="stylesheet" href="./css/layui.css">
  <style type="text/css">
	.h1title{
		line-height: 50px;
		text-align: center;
	}
	.printcontentdemo{
		padding: 10px;
    	line-height: 50px;
    	text-align: center;
    	background-color: #79C48C;
    	color: #fff;
    	border: 5px solid black;
    	margin-bottom: 15px;
	}
  </style>
</head>
<body>
 
<!-- 你的HTML代码 -->
	<div class="layui-container">  
	  <h1 class="h1title">深圳大学校长办公室座位牌打印系统</h1>

	  <blockquote class="layui-elem-quote layui-text">
		  卡片信息
	  </blockquote>

	  <form class="layui-form layui-form-pane" action="">
	  	<div class="layui-form-item layui-form-text">
		    <label class="layui-form-label">卡片名字（多个名字用中文逗号'，'分隔）</label>
		    <div class="layui-input-block">
		      <textarea placeholder="请输入姓名" class="layui-textarea" name="multiname" lay-verify="name"></textarea>
		    </div>
		</div>

		<div class="layui-form-item">
		    <label class="layui-form-label">重复次数</label>
		    <div class="layui-input-inline">
		      <select name="cishu">
		        <option value="1">1</option>
		        <option value="2" selected="">2</option>
		        <option value="3">3</option>
		        <option value="400">4</option>
		      </select>
		    </div>

			<label class="layui-form-label">规格</label>
		    <div class="layui-input-inline">
		      <select name="type">
		        <option value="100">100</option>
		        <option value="200" selected="">200</option>
		        <option value="300">300</option>
		        <option value="400">400</option>
		      </select>
		    </div>
		</div>

		<div class="layui-form-item">
		    <div class="layui-input-block">
		      <button class="layui-btn" lay-submit="" lay-filter="preview">预览</button>
		      <button class="layui-btn" lay-submit="" lay-filter="print">打印</button>
		    </div>
	  	</div>
	  </form>
	  
	  <div id="printcontent">
	  	
	  </div>
	</div>

<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<script src="./js/jquery.min.js"></script>
<script src="./js/layui.js"></script>
<script src="./js/printThis.js"></script>
<script>
//一般直接写在一个js文件中
layui.use(['layer', 'form'], function(){
  var layer = layui.layer
  ,form = layui.form;
  
  //自定义验证规则
  form.verify({
    name: function(value){
      if(value.length < 2){
        return '请输入要打印的姓名';
      }
    }
  });

  //监听打印预览
  form.on('submit(preview)', function(data){
    layer.alert(JSON.stringify(data.field), {
      title: '最终的提交信息'
    })

    var allname_arr = getallname(data.field.multiname)
    let cishu = data.field.cishu,
    	guige = (data.field.type).split('*')
    let chang = guige[0],
    	kuan = guige[1]
    console.log(allname_arr)
    console.log('总共输入',allname_arr.length,'个姓名')
    console.log('重复次数',data.field.cishu)
    console.log('规格',data.field.type)

    //生成要打印的内容,一个名字一行
    let finalarr = new Array()
    for(let i=0;i<allname_arr.length;i++){
    	for(let j=0;j<cishu;j++){
    		finalarr.push(allname_arr[i])
    	}
    }
    console.log('finalarr',finalarr)
    
    for(let i=0;i<finalarr.length;i++){
    	let str = "<div class='layui-row'><div class='layui-col-lg12'>"+
    	"<div class='printcontentdemo'>"+finalarr[i]+"</div></div></div>"
	    $("#printcontent").append(str);

    }
    console.log($('.printcontentdemo').attr("class"))
    return false
    $('.printcontentdemo').style.cssText='width:600px;height:250px;border:1px red solid;';
    //Preview()return false
    return false;
  });
 
  layer.msg('Hello World');
});

		//打印预览
        function Preview() {
            $("#printContent").printThis({
                debug: false,
                importCSS: true,
                importStyle: true,
                printContainer: true,
                //loadCSS: "/Content/Themes/Default/style.css",
                pageTitle: "通知公告",
                removeInline: false,
                printDelay: 333,
                header: null,
                formValues: true
            });
        };

    //去除空格，逗号等符号
    function getallname(str) {
    	//var temp = new Array()
    	var temp = str.split(/[\\n\s+,，；;]/g);
		var temp1 = temp.join(" ")
		var temp2 = temp1.trim(); //去掉空白(/(^\s*)|(\s*$)/g, "");
		var temp3 = temp2.split(' ')

		for (var i = 0; i < temp.length; i++) {
			console.log(i,temp[i])
			if (temp[i] == "" || temp[i] == null || temp[i].length == 0) {
				// 删除数组中空值
				temp.splice(i, 1);
				i--;
			}
		}
		//console.log(temp);
		return temp
	}

</script> 
</body>
</html>